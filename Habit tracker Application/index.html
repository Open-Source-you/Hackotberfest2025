<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Habit Tracker</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: #f4f7fc;
        color: #2d3748;
        overflow-x: hidden;
        line-height: 1.6;
      }

      header {
        position: relative;
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)),
          url("https://images.unsplash.com/photo-1516321310764-8a3b0e4b63e0?fit=crop&w=1600&h=900")
            no-repeat center center/cover;
        color: white;
        padding: 100px 20px;
        text-align: center;
        min-height: 500px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        /* animation: fadeIn 1.5s ease-in-out; */
      }

      header h1 {
        font-size: 3.5em;
        font-weight: 700;
        text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.6);
        animation: slideInFromTop 1s ease-out;
      }

      header p {
        font-size: 1.6em;
        margin-top: 15px;
        max-width: 700px;
        animation: typing 3s steps(40) forwards;
        white-space: nowrap;
        overflow: hidden;
      }

      header img.hero-icon {
        width: 70px;
        margin-top: 20px;
        animation: bounce 2s infinite;
      }

      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
      }

      header.parallax {
        background-attachment: fixed;
      }

      nav {
        background-color: #1a202c;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      nav .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
      }

      nav ul {
        list-style: none;
        display: flex;
        align-items: center;
      }

      nav ul li {
        margin: 0 15px;
      }

      nav ul li a {
        color: white;
        text-decoration: none;
        padding: 15px 20px;
        font-size: 1.1em;
        font-weight: 500;
        transition: background 0.3s, transform 0.3s, color 0.3s;
        border-radius: 8px;
      }

      nav ul li a:hover,
      nav ul li a.active {
        background: #38b2ac;
        color: #fff;
        transform: translateY(-2px);
      }

      .hamburger {
        display: none;
        font-size: 1.8em;
        color: white;
        cursor: pointer;
        padding: 15px;
        transition: transform 0.3s;
      }

      .hamburger:hover {
        transform: scale(1.1);
      }

      .container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 30px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        animation: fadeInUp 1s ease-out;
      }

      .section {
        margin-bottom: 40px;
        padding: 25px;
        background: #f9fafb;
        border-radius: 12px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .section:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #2b6cb0;
        font-size: 2em;
        font-weight: 600;
        margin-bottom: 20px;
        position: relative;
      }

      h2::after {
        content: "";
        width: 80px;
        height: 4px;
        background: #2b6cb0;
        position: absolute;
        bottom: -10px;
        left: 0;
        border-radius: 2px;
      }

      #habit-form {
        display: flex;
        flex-direction: column;
        max-width: 600px;
        margin-bottom: 20px;
      }

      #habit-form input,
      #habit-form textarea {
        margin-bottom: 15px;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        transition: border 0.3s, box-shadow 0.3s;
      }

      #habit-form input:focus,
      #habit-form textarea:focus {
        border-color: #2b6cb0;
        box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.1);
        outline: none;
      }

      #habit-form button {
        padding: 12px;
        font-size: 16px;
        font-weight: 600;
        background: linear-gradient(45deg, #2b6cb0, #4299e1);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      #habit-form button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(43, 108, 176, 0.3);
      }

      #habit-list,
      #recent-habits {
        list-style: none;
        padding: 0;
      }

      #habit-list li {
        background: #fff;
        margin-bottom: 15px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        animation: fadeIn 0.5s ease-in;
        transition: box-shadow 0.3s;
      }

      #habit-list li:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      }

      #habit-list li .progress-bar {
        width: 100%;
        height: 8px;
        background: #edf2f7;
        border-radius: 4px;
        margin-top: 10px;
        overflow: hidden;
      }

      #habit-list li .progress-bar div {
        height: 100%;
        background: linear-gradient(45deg, #38b2ac, #2b6cb0);
        transition: width 0.5s ease-in-out;
      }

      #habit-list li .habit-info {
        flex: 1;
      }

      #habit-list li button {
        background: #e53e3e;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        margin-left: 10px;
        font-weight: 500;
        transition: background 0.3s, transform 0.3s;
      }

      #habit-list li button:hover {
        background: #c53030;
        transform: translateY(-1px);
      }

      #habit-list li button.complete-btn {
        background: #38b2ac;
      }

      #habit-list li button.complete-btn:hover {
        background: #319795;
      }

      #get-tip-btn {
        padding: 12px 20px;
        font-size: 16px;
        font-weight: 600;
        background: linear-gradient(45deg, #ed8936, #f6ad55);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 20px;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      #get-tip-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 18px rgba(237, 137, 54, 0.3);
      }

      #random-tip {
        font-style: italic;
        color: #4a5568;
        padding: 15px;
        background: #f7fafc;
        border-left: 5px solid #2b6cb0;
        border-radius: 8px;
        min-height: 50px;
        transition: opacity 0.3s ease-in-out;
      }

      #all-tips li {
        margin-bottom: 10px;
        padding: 12px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s;
      }

      #all-tips li:hover {
        transform: translateY(-2px);
      }

      #all-tips li i {
        margin-right: 10px;
        color: #ed8936;
      }

      #tracker .progress-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 20px;
      }

      #tracker .progress-item {
        flex: 1 1 200px;
        text-align: center;
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }

      #tracker .progress-item:hover {
        transform: translateY(-3px);
      }

      #tracker .progress-ring {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 0 auto 10px;
      }

      #tracker .progress-ring svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
      }

      #tracker .progress-ring circle {
        fill: none;
        stroke: #edf2f7;
        stroke-width: 8;
      }

      #tracker .progress-ring .progress {
        stroke: #38b2ac;
        stroke-width: 8;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.5s ease-in-out;
      }

      #tracker .progress-ring span {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.2em;
        font-weight: 600;
        color: #2d3748;
      }

      #tracker .progress-item button {
        background: #38b2ac;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
        font-weight: 500;
        transition: background 0.3s, transform 0.3s;
      }

      #tracker .progress-item button:hover {
        background: #319795;
        transform: translateY(-1px);
      }

      #tracker .progress-item button:disabled {
        background: #a0aec0;
        cursor: not-allowed;
      }

      /* Calendar Styles for 21-Day Tracker */
      #tracker .calendar-container {
        margin-top: 20px;
        display: grid;
        grid-template-columns: repeat(
          7,
          1fr
        ); /* 7 columns for a week-like layout */
        gap: 10px;
        padding: 10px;
        background: #f9fafb;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      #tracker .calendar-day {
        background: #fff;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        padding: 10px;
        text-align: center;
        font-size: 0.9em;
        cursor: pointer;
        transition: background 0.3s, transform 0.3s;
      }

      #tracker .calendar-day.completed {
        background: #38b2ac;
        color: white;
        border-color: #319795;
      }

      #tracker .calendar-day:hover:not(.disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      #tracker .calendar-day.disabled {
        background: #a0aec0;
        cursor: not-allowed;
        color: #718096;
      }

      #recent-habits li {
        background: #fff;
        margin-bottom: 10px;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        transition: box-shadow 0.3s;
      }

      #recent-habits li:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      footer {
        background: #1a202c;
        color: white;
        text-align: center;
        padding: 20px;
        font-size: 0.9em;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInFromTop {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes typing {
        from {
          width: 0;
        }
        to {
          width: 100%;
        }
      }

      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-10px);
        }
        60% {
          transform: translateY(-5px);
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        header {
          padding: 60px 20px;
          min-height: 400px;
        }

        header h1 {
          font-size: 2.5em;
        }

        header p {
          font-size: 1.3em;
        }

        header img.hero-icon {
          width: 60px;
        }

        nav ul {
          display: none;
          flex-direction: column;
          width: 100%;
          background: #1a202c;
          position: absolute;
          top: 60px;
          left: 0;
        }

        nav ul.active {
          display: flex;
        }

        nav ul li {
          margin: 0;
          width: 100%;
        }

        nav ul li a {
          padding: 15px;
          text-align: center;
        }

        .hamburger {
          display: block;
        }

        .container {
          margin: 20px;
          padding: 20px;
        }

        #tracker .progress-item {
          flex: 1 1 100%;
        }

        #tracker .calendar-container {
          grid-template-columns: repeat(
            3,
            1fr
          ); /* 3 columns on mobile for better fit */
          gap: 8px;
        }

        #tracker .calendar-day {
          padding: 8px;
          font-size: 0.8em;
        }
      }
    </style>
  </head>
  <body>
    <header class="parallax">
      <div id="particles-js"></div>
      <h1>Habit Tracker</h1>
      <p>Build Better Habits, One Day at a Time</p>
      <img
        src="https://img.icons8.com/ios-filled/50/ffffff/checklist.png"
        alt="Checklist Icon"
        class="hero-icon"
      />
    </header>

    <nav>
      <div class="nav-container">
        <div class="hamburger"><i class="fas fa-bars"></i></div>
        <ul>
          <li>
            <a href="#habits" class="nav-link active"
              ><i class="fas fa-tasks"></i> Habits</a
            >
          </li>
          <li>
            <a href="#tips" class="nav-link"
              ><i class="fas fa-lightbulb"></i> Tips</a
            >
          </li>
          <li>
            <a href="#tracker" class="nav-link"
              ><i class="fas fa-chart-line"></i> Progress</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <div class="container">
      <div id="habits" class="section">
        <h2>Your Habits</h2>
        <p>Add and track your daily habits to stay consistent.</p>
        <form id="habit-form">
          <input
            type="text"
            id="habit-name"
            placeholder="Enter habit name (e.g., Read 30 mins)"
            required
          />
          <textarea
            id="habit-description"
            placeholder="Habit description (optional)"
          ></textarea>
          <button type="submit">Add Habit</button>
        </form>
        <ul id="habit-list"></ul>
      </div>

      <div id="tips" class="section">
        <h2>Habit Building Tips</h2>
        <p>Get inspired with random tips to form habits consistently.</p>
        <button id="get-tip-btn">Get Random Tip</button>
        <div id="random-tip" role="alert"></div>
        <div id="tips-container">
          <h3>All Tips</h3>
          <ul id="all-tips"></ul>
        </div>
      </div>

      <div id="tracker" class="section">
        <h2>Progress Tracker</h2>
        <p>
          Monitor your habit-building journey with completion percentages and a
          21-day calendar.
        </p>
        <div class="progress-container" id="progress-container"></div>
        <h3>Recent Habits</h3>
        <ul id="recent-habits"></ul>
      </div>
    </div>

    <footer>
      <p>&copy; 2025 Habit Tracker. All rights reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
      // Particles.js Configuration
      particlesJS("particles-js", {
        particles: {
          number: { value: 80, density: { enable: true, value_area: 800 } },
          color: { value: "#ffffff" },
          shape: { type: "circle", stroke: { width: 0, color: "#000000" } },
          opacity: { value: 0.5, random: true },
          size: { value: 3, random: true },
          line_linked: {
            enable: true,
            distance: 150,
            color: "#ffffff",
            opacity: 0.4,
            width: 1,
          },
          move: {
            enable: true,
            speed: 2,
            direction: "none",
            random: false,
            straight: false,
            out_mode: "out",
            bounce: false,
          },
        },
        interactivity: {
          detect_on: "canvas",
          events: {
            onhover: { enable: true, mode: "repulse" },
            onclick: { enable: true, mode: "push" },
            resize: true,
          },
          modes: {
            repulse: { distance: 100, duration: 0.4 },
            push: { particles_nb: 4 },
          },
        },
        retina_detect: true,
      });

      // Navbar Toggle for Mobile
      const hamburger = document.querySelector(".hamburger");
      const navUl = document.querySelector("nav ul");
      if (hamburger && navUl) {
        hamburger.addEventListener("click", () => {
          navUl.classList.toggle("active");
          console.log("Toggled mobile menu");
        });
      } else {
        console.error("Hamburger or navUl not found");
      }

      // Smooth Scrolling and Active Link
      const navLinks = document.querySelectorAll(".nav-link");
      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          navLinks.forEach((l) => l.classList.remove("active"));
          link.classList.add("active");
          const targetId = link.getAttribute("href").substring(1);
          const targetSection = document.getElementById(targetId);
          if (targetSection) {
            targetSection.scrollIntoView({ behavior: "smooth" });
          }
          if (window.innerWidth <= 768) {
            navUl.classList.remove("active");
          }
        });
      });

      // Habit Tracker
      const habitForm = document.getElementById("habit-form");
      const habitList = document.getElementById("habit-list");
      const recentHabitsList = document.getElementById("recent-habits");
      const progressContainer = document.getElementById("progress-container");
      let habits = JSON.parse(localStorage.getItem("habits")) || [];

      // Initialize habits with days array if not present
      habits.forEach((habit) => {
        if (!habit.days) {
          habit.days = Array(21).fill(false); // Initialize 21 days as not completed
        }
      });
      localStorage.setItem("habits", JSON.stringify(habits));

      function renderHabits() {
        console.log("Rendering habits:", habits);
        if (!habitList || !recentHabitsList || !progressContainer) {
          console.error("DOM elements missing:", {
            habitList,
            recentHabitsList,
            progressContainer,
          });
          return;
        }

        habitList.innerHTML = "";
        recentHabitsList.innerHTML = "";
        progressContainer.innerHTML = "";

        // Calculate total completion percentage for all habits
        const totalHabits = habits.length;
        const completedHabits = habits.filter((h) => h.completed).length;
        const overallCompletion =
          totalHabits > 0
            ? Math.round((completedHabits / totalHabits) * 100)
            : 0;

        // Render overall completion ring
        if (totalHabits > 0) {
          const overallItem = document.createElement("div");
          overallItem.className = "progress-item";
          const radius = 46;
          const circumference = 2 * Math.PI * radius;
          const offset =
            circumference - (overallCompletion / 100) * circumference;
          overallItem.innerHTML = `
                    <h3>Overall Progress</h3>
                    <div class="progress-ring">
                        <svg>
                            <circle cx="50" cy="50" r="${radius}"/>
                            <circle class="progress" cx="50" cy="50" r="${radius}" style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${offset};"/>
                        </svg>
                        <span>${overallCompletion}%</span>
                    </div>
                    <p>${completedHabits}/${totalHabits} Habits Completed</p>
                `;
          progressContainer.appendChild(overallItem);
        }

        // Render individual habits
        const today = new Date().toISOString().split("T")[0];
        habits.forEach((habit, index) => {
          // Calculate progress based on days completed
          const completedDays = habit.days.filter((day) => day).length;
          const progressPercent = Math.min((completedDays / 21) * 100, 100);

          // Habit list
          const habitLi = document.createElement("li");
          habitLi.innerHTML = `
                    <div class="habit-info">
                        <i class="fas fa-tasks"></i> ${habit.name} ${
            habit.description ? `<br><small>${habit.description}</small>` : ""
          }
                        <div class="progress-bar"><div style="width: ${progressPercent}%"></div></div>
                        <span>Streak: ${habit.streak} days | ${
            habit.completed ? "Completed Today" : "Not Completed Today"
          }</span>
                    </div>
                    <div>
                        <button class="complete-btn" onclick="toggleComplete(${index})">${
            habit.completed ? "Undo" : "Complete"
          }</button>
                        <button onclick="removeHabit(${index})">Remove</button>
                    </div>
                `;
          habitList.appendChild(habitLi);

          // Recent habits (last 5)
          if (index >= Math.max(0, habits.length - 5)) {
            const recentLi = document.createElement("li");
            recentLi.innerHTML = `<i class="fas fa-check-circle"></i> ${habit.name} - Streak: ${habit.streak} days`;
            recentHabitsList.appendChild(recentLi);
          }

          // Progress ring and calendar for each habit
          const progressItem = document.createElement("div");
          progressItem.className = "progress-item";
          const radius = 46;
          const circumference = 2 * Math.PI * radius;
          const offset =
            circumference - (progressPercent / 100) * circumference;
          const isNextDayDisabled = habit.lastCompleted === today;
          const isPrevDayDisabled = habit.streak === 0;

          // Generate calendar HTML
          let calendarHTML = '<div class="calendar-container">';
          for (let day = 0; day < 21; day++) {
            const isCompleted = habit.days[day];
            const isDisabled = day > habit.streak; // Disable future days
            calendarHTML += `
                        <div class="calendar-day ${
                          isCompleted ? "completed" : ""
                        } ${isDisabled ? "disabled" : ""}"
                             onclick="${
                               isDisabled ? "" : `toggleDay(${index}, ${day})`
                             }">
                            Day ${day + 1}
                        </div>
                    `;
          }
          calendarHTML += "</div>";

          progressItem.innerHTML = `
                    <h3>${habit.name}</h3>
                    <div class="progress-ring">
                        <svg>
                            <circle cx="50" cy="50" r="${radius}"/>
                            <circle class="progress" cx="50" cy="50" r="${radius}" style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${offset};"/>
                        </svg>
                        <span>${Math.round(progressPercent)}%</span>
                    </div>
                    <p>Streak: ${habit.streak} days</p>
                    <button onclick="incrementStreak(${index})" ${
            isNextDayDisabled ? "disabled" : ""
          }>Mark Next Day</button>
                    <button onclick="decrementStreak(${index})" ${
            isPrevDayDisabled ? "disabled" : ""
          }>Mark Previous Day</button>
                    ${calendarHTML}
                `;
          progressContainer.appendChild(progressItem);
        });
      }

      if (habitForm) {
        habitForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const nameInput = document.getElementById("habit-name");
          const descriptionInput = document.getElementById("habit-description");
          if (!nameInput || !descriptionInput) {
            console.error("Form inputs not found");
            alert("Error: Form inputs not found. Please refresh the page.");
            return;
          }

          const name = nameInput.value.trim();
          const description = descriptionInput.value.trim();

          if (name === "") {
            alert("Please enter a habit name.");
            return;
          }

          const newHabit = {
            name,
            description,
            streak: 0,
            completed: false,
            lastCompleted: null,
            days: Array(21).fill(false), // Initialize 21 days
          };
          habits.push(newHabit);
          localStorage.setItem("habits", JSON.stringify(habits));
          console.log("Added habit:", newHabit);
          renderHabits();
          habitForm.reset();
        });
      } else {
        console.error("Habit form not found");
      }

      window.toggleComplete = function (index) {
        if (index < 0 || index >= habits.length) {
          console.error("Invalid habit index:", index);
          return;
        }
        const habit = habits[index];
        const today = new Date().toISOString().split("T")[0];
        if (!habit.completed) {
          habit.completed = true;
          if (habit.lastCompleted !== today && habit.streak < 21) {
            habit.streak += 1;
            habit.lastCompleted = today;
            habit.days[habit.streak - 1] = true; // Mark current day in calendar
          }
        } else {
          habit.completed = false;
          if (habit.lastCompleted === today && habit.streak > 0) {
            habit.streak -= 1;
            habit.days[habit.streak] = false; // Unmark current day
          }
        }
        localStorage.setItem("habits", JSON.stringify(habits));
        console.log("Toggled completion for habit:", habit);
        renderHabits();
      };

      window.incrementStreak = function (index) {
        if (index < 0 || index >= habits.length) {
          console.error("Invalid habit index:", index);
          return;
        }
        const habit = habits[index];
        const today = new Date().toISOString().split("T")[0];
        if (habit.lastCompleted !== today && habit.streak < 21) {
          habit.streak += 1;
          habit.lastCompleted = today;
          habit.completed = true;
          habit.days[habit.streak - 1] = true; // Mark current day
          localStorage.setItem("habits", JSON.stringify(habits));
          console.log("Incremented streak for habit:", habit);
          renderHabits();
        } else {
          console.log(
            "Streak already incremented today or max reached for habit:",
            habit.name
          );
        }
      };

      window.decrementStreak = function (index) {
        if (index < 0 || index >= habits.length) {
          console.error("Invalid habit index:", index);
          return;
        }
        const habit = habits[index];
        if (habit.streak > 0) {
          habit.days[habit.streak - 1] = false; // Unmark the last day
          habit.streak -= 1;
          habit.completed = false;
          habit.lastCompleted = null;
          localStorage.setItem("habits", JSON.stringify(habits));
          console.log("Decremented streak for habit:", habit);
          renderHabits();
        } else {
          console.log("Cannot decrement streak below 0 for habit:", habit.name);
        }
      };

      window.toggleDay = function (index, day) {
        if (index < 0 || index >= habits.length || day < 0 || day >= 21) {
          console.error("Invalid habit index or day:", index, day);
          return;
        }
        const habit = habits[index];
        if (day > habit.streak) {
          console.log("Cannot mark future days for habit:", habit.name);
          return;
        }
        const today = new Date().toISOString().split("T")[0];
        habit.days[day] = !habit.days[day]; // Toggle day completion
        // Update streak based on the last consecutive completed day
        let newStreak = 0;
        for (let i = 0; i < 21; i++) {
          if (habit.days[i]) {
            newStreak = i + 1;
          } else {
            break;
          }
        }
        habit.streak = newStreak;
        // Update completed status for today
        habit.completed =
          habit.days[habit.streak - 1] && habit.lastCompleted === today;
        habit.lastCompleted = habit.completed ? today : null;
        localStorage.setItem("habits", JSON.stringify(habits));
        console.log(`Toggled day ${day + 1} for habit:`, habit);
        renderHabits();
      };

      window.removeHabit = function (index) {
        if (index < 0 || index >= habits.length) {
          console.error("Invalid habit index:", index);
          return;
        }
        habits.splice(index, 1);
        localStorage.setItem("habits", JSON.stringify(habits));
        console.log("Removed habit at index:", index);
        renderHabits();
      };

      // Reset completed status daily
      function resetDaily() {
        const today = new Date().toISOString().split("T")[0];
        habits.forEach((habit) => {
          if (habit.lastCompleted !== today) {
            habit.completed = false;
          }
        });
        localStorage.setItem("habits", JSON.stringify(habits));
        console.log("Daily reset performed");
        renderHabits();
      }

      // Habit Tips
      const tips = [
        "Start small to build sustainable habits.",
        "Track your habits daily to stay accountable.",
        "Set specific times for your habits to create a routine.",
        "Celebrate small wins to stay motivated.",
        "Use visual cues to remind you of your habits.",
        "Pair new habits with existing ones for consistency.",
        "Review your progress weekly to adjust your goals.",
        "Stay patient; habits take time to form.",
        "Avoid breaking the chain of consistency.",
        "Focus on one habit at a time for better results.",
      ];

      const getTipBtn = document.getElementById("get-tip-btn");
      const randomTip = document.getElementById("random-tip");
      const allTipsList = document.getElementById("all-tips");

      if (allTipsList) {
        tips.forEach((tip) => {
          const li = document.createElement("li");
          li.innerHTML = `<i class="fas fa-check-circle"></i> ${tip}`;
          allTipsList.appendChild(li);
        });
      } else {
        console.error("All tips list not found");
      }

      if (getTipBtn && randomTip) {
        getTipBtn.addEventListener("click", () => {
          if (tips.length === 0) {
            randomTip.textContent = "No tips available.";
            console.log("No tips available");
            return;
          }
          const randomIndex = Math.floor(Math.random() * tips.length);
          randomTip.textContent = tips[randomIndex];
          randomTip.style.opacity = "0";
          setTimeout(() => {
            randomTip.style.opacity = "1";
          }, 100);
          console.log("Displayed random tip:", tips[randomIndex]);
        });
      } else {
        console.error("Get tip button or random tip element not found");
      }

      // Initial render and daily reset
      resetDaily();
    </script>
  </body>
</html>
